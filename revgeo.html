<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <title>SRG 데이터 역지오코딩 도구</title>
  <meta name="description" content="random_data.txt 파일의 위경도 좌표를 주소로 변환(역지오코딩)해주는 웹 도구입니다.">
  <meta property="og:type" content="website">
  <meta property="og:title" content="SRG 데이터 역지오코딩 도구">
  <meta property="og:description" content="대량의 좌표 데이터를 주소로 빠르고 안전하게 변환하세요.">
  <link rel="icon" href="icon.svg?v=2" type="image/svg+xml" sizes="any">
  <link rel="manifest" href="site.webmanifest">
  <link rel="preconnect" href="https://nominatim.openstreetmap.org" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" crossorigin
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css?ver=1.3.9">
  <style>
    @layer reset, theme, layout, components, utilities;

    @layer reset {

      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        min-height: 100dvh;
      }

      fieldset {
        margin: 0;
        padding: 0;
        border: 0;
      }

      button,
      input,
      textarea {
        font-family: inherit;
      }

      p {
        margin: 0;
      }
    }

    @layer theme {
      :root {
        color-scheme: light dark;
        --bg-grad-start: light-dark(oklch(97% 0.01 240), oklch(12% 0.02 240));
        --bg-grad-end: light-dark(oklch(92% 0.02 250), oklch(8% 0.03 260));
        --card-bg: light-dark(rgba(255, 255, 255, 0.7),
            rgba(30, 41, 59, 0.6));
        --card-border: light-dark(rgba(255, 255, 255, 0.4),
            rgba(255, 255, 255, 0.1));
        --inner-glow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        --fg: light-dark(oklch(20% 0.02 260), oklch(92% 0.01 240));
        --muted: light-dark(oklch(50% 0.05 260), oklch(65% 0.04 260));
        --line: light-dark(rgba(0, 0, 0, 0.08), rgba(255, 255, 255, 0.1));
        --accent: light-dark(oklch(55% 0.22 270), oklch(65% 0.18 260));
        --accent-glow: light-dark(oklch(55% 0.22 270/0.4),
            oklch(65% 0.18 260/0.4));
        --success: light-dark(oklch(60% 0.18 150), oklch(70% 0.15 150));
        --warn: light-dark(oklch(65% 0.18 50), oklch(75% 0.15 50));
        --err: light-dark(oklch(55% 0.22 25), oklch(65% 0.2 25));
        --spotlight: light-dark(rgba(0, 0, 0, 0.05),
            rgba(255, 255, 255, 0.1));
        --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.02),
          0 1px 2px rgba(0, 0, 0, 0.03);
        --shadow-md: 0 20px 40px -10px rgba(0, 0, 0, 0.1), var(--inner-glow);
        --glass: blur(12px) saturate(180%);
        --fs-base: clamp(13px, 1.2vw, 15px);
        --fs-sm: clamp(11px, 0.9vw, 13px);
        --fs-lg: clamp(16px, 1.6vw, 20px);
        --fs-xl: clamp(18px, 2vw, 24px);
        font-family: "Pretendard", -apple-system, BlinkMacSystemFont,
          system-ui, sans-serif;
      }

      body {
        background-color: var(--bg-grad-start);
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E"),
          linear-gradient(135deg, var(--bg-grad-start), var(--bg-grad-end));
        color: var(--fg);
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        letter-spacing: -0.01em;
        overflow-x: hidden;
        overflow-y: auto;
        transition: opacity 0.2s ease;
        container-type: inline-size;
        font-variant-numeric: tabular-nums;
        font-size: var(--fs-base);

        &.is-dragging {
          opacity: 0.8;
        }

        @media (max-width: 800px) {
          & {
            padding: 12px;
          }
        }
      }
    }

    @layer layout {
      main {
        width: min(1600px, 100%);
        display: grid;
        grid-template-columns: clamp(320px, 25vw, 420px) 1fr;
        gap: 16px;
        align-items: stretch;
        height: clamp(650px, calc(100vh - 40px), 1000px);

        >section {
          min-width: 0;
          height: 100%;
          display: flex;
          flex-direction: column;
        }

        @container (max-width: 800px) {
          & {
            grid-template-columns: 1fr;
            height: auto;
            min-height: 0;
            gap: 20px;
          }
        }
      }

      footer {
        text-align: center;
        font-size: var(--fs-sm);
        color: var(--muted);
        opacity: 0.7;
        margin-top: 8px;
      }
    }

    @layer components {
      .card {
        background: var(--card-bg);
        backdrop-filter: var(--glass);
        border: 1px solid var(--card-border);
        border-radius: clamp(16px, 2vw, 24px);
        padding: clamp(16px, 2.4vw, 24px);
        box-shadow: var(--shadow-md);
        display: flex;
        flex-direction: column;
        gap: 16px;
        max-width: 100%;
        overflow: hidden;
        position: relative;
        container-type: inline-size;
        container-name: card;

        &>div:has(#coords) {
          flex: 1;
          display: flex;
          flex-direction: column;
          min-height: 100px;
        }

        .card-header {
          display: flex;
          align-items: baseline;
          gap: 12px;
          flex-wrap: wrap;
          flex-shrink: 0;

          #results-title {
            font-size: var(--fs-lg);
            font-weight: 700;
            margin: 0;
            color: var(--fg);
          }

          .header-desc {
            margin: 0;
            color: var(--muted);
            font-weight: 400;
          }
        }

        &::before {
          content: "";
          position: absolute;
          pointer-events: none;
          inset: 0;
          border-radius: inherit;
          background: radial-gradient(800px circle at var(--mouse-x, 0) var(--mouse-y, 0),
              var(--spotlight),
              transparent 40%);
          opacity: 0;
          transition: opacity 0.3s;
          z-index: 2;
        }

        &:hover::before {
          opacity: 1;
        }
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 4px;

        svg {
          color: var(--accent);
          filter: drop-shadow(0 0 8px var(--accent-glow));
          width: 32px;
          height: 32px;
        }

        div {
          display: flex;
          flex-direction: column;
        }

        h1 {
          margin: 0;
          font-weight: 700;
          line-height: 1.2;
          font-size: var(--fs-xl);
        }

        p {
          color: var(--muted);
          font-size: var(--fs-sm);
        }
      }

      form.row {
        width: 100%;
        flex-shrink: 0;
      }

      fieldset.row {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;

        .row {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 8px;
          width: 100%;
        }
      }

      .drop-zone {
        position: relative;
        border: 2px dashed var(--line);
        border-radius: 16px;
        padding: 12px;
        text-align: center;
        transition: all 0.2s ease;
        background: light-dark(rgba(255, 255, 255, 0.3), rgba(0, 0, 0, 0.1));
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        word-break: keep-all;
        flex-shrink: 0;
        overflow: hidden;

        &:hover,
        &:focus-within {
          border-color: var(--accent);
          background: light-dark(rgba(255, 255, 255, 0.5),
              rgba(0, 0, 0, 0.2));
          transform: scale(1.01);
        }

        input[type="file"] {
          position: absolute;
          inset: 0;
          opacity: 0;
          cursor: pointer;
          width: 100%;
          height: 100%;
          z-index: 10;
        }

        .drop-icon {
          width: 32px;
          height: 32px;
          margin-bottom: 6px;
          color: var(--muted);
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        &:hover .drop-icon,
        &:focus-within .drop-icon {
          color: var(--accent);
          transform: translateY(-5px) scale(1.1);
          filter: drop-shadow(0 4px 6px var(--accent-glow));
        }

        .drop-text {
          color: var(--muted);
          font-weight: 500;

          strong {
            color: var(--fg);
          }
        }

        .desktop-msg {
          display: inline;
        }

        .mobile-msg {
          display: none;
        }

        @media (max-width: 800px) and (pointer: coarse) {
          & .desktop-msg {
            display: none;
          }

          & .mobile-msg {
            display: inline;
          }
        }
      }

      textarea,
      button {
        border-radius: 12px;
        border: 1px solid var(--line);
        background: light-dark(rgba(255, 255, 255, 0.5), rgba(0, 0, 0, 0.2));
        color: var(--fg);
        padding: 10px 14px;
        transition: all 0.2s;
      }

      textarea {
        width: 100%;
        height: 100%;
        flex: 1;
        overflow-y: auto;
        font-family: inherit;
        line-height: 1.5;
        resize: none;
        padding: 10px 8px;
        word-break: keep-all;

        &:focus {
          outline: none;
          border-color: var(--accent);
          box-shadow: 0 0 0 3px var(--accent-glow);
        }
      }

      button {
        cursor: pointer;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        min-width: 0;
        white-space: nowrap;
        padding: 12px 4px;
        background: light-dark(rgba(255, 255, 255, 0.8),
            rgba(255, 255, 255, 0.05));
        position: relative;
        overflow: hidden;

        &::after {
          content: "";
          position: absolute;
          inset: 0;
          background: radial-gradient(circle at var(--mouse-x, 0) var(--mouse-y, 0),
              rgba(255, 255, 255, 0.2),
              transparent 50%);
          opacity: 0;
          transition: opacity 0.3s;
          pointer-events: none;
        }

        &:hover:not(:disabled) {
          &::after {
            opacity: 1;
          }

          background: light-dark(#fff, rgba(255, 255, 255, 0.1));
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        &:active:not(:disabled) {
          transform: translateY(0);
        }

        &:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          filter: grayscale(1);
        }

        &#parse,
        &#start {
          background: var(--accent);
          color: #fff;
          border-color: transparent;
          box-shadow: 0 4px 10px var(--accent-glow);

          &:hover:not(:disabled) {
            filter: brightness(1.1);
            box-shadow: 0 6px 14px var(--accent-glow);
          }
        }

        &#stop {
          color: var(--err);

          &:hover:not(:disabled) {
            background: light-dark(rgba(220, 38, 38, 0.1),
                rgba(220, 38, 38, 0.2));
          }
        }
      }

      .row-progress {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 12px;
        flex-shrink: 0;

        >.sp {
          flex: 1;
          min-width: 0;
          display: flex;
          flex-direction: column;
        }

        #counts {
          flex: 0 0 auto;
          font-size: var(--fs-sm);
          text-align: right;
          line-height: 1.3;
          white-space: nowrap;
          letter-spacing: -0.03em;
        }
      }

      .progress-shell {
        --pct: 0;
        width: 100%;
        margin-top: 6px;
        position: relative;
        border-radius: 999px;
        background: var(--line);
        overflow: hidden;
      }

      .progress-shell>progress {
        width: 100%;
        height: 6px;
        border: none;
        margin: 0;
        padding: 0;
        opacity: 0;
      }

      .progress-visual {
        position: absolute;
        inset: 0;
        border-radius: inherit;
        pointer-events: none;
      }

      .progress-fill {
        height: 100%;
        width: calc(var(--pct, 0) * 1%);
        background: linear-gradient(90deg, var(--accent), var(--success));
        transition: width 0.25s ease-out;
        will-change: width;
      }

      .progress-shell.active .progress-fill {
        animation: shimmer 1.5s linear infinite;
        background: linear-gradient(90deg,
            var(--accent),
            var(--success),
            var(--accent));
        background-size: 200% 100%;
      }

      .status {
        margin-block-start: 10px;
        padding-block: 10px;
        padding-inline: 14px;
        border-radius: 8px;
        background: light-dark(rgba(0, 0, 0, 0.03),
            rgba(255, 255, 255, 0.05));
        border-inline-start: 3px solid var(--muted);
        animation: fadeIn 0.3s ease;
        word-break: keep-all;
        overflow-wrap: break-word;
        text-wrap: pretty;
        flex-shrink: 0;

        &:empty {
          display: none;
        }

        &.err {
          color: var(--err);
          border-inline-start-color: var(--err);
          background: light-dark(oklch(95% 0.1 25),
              rgba(220, 38, 38, 0.1));
        }

        &.warn {
          color: var(--warn);
          border-inline-start-color: var(--warn);
          background: light-dark(oklch(98% 0.1 50),
              rgba(245, 158, 11, 0.1));
        }
      }

      .table-wrap {
        flex: 1;
        width: 100%;
        border-radius: 16px;
        border: 1px solid var(--line);
        background: light-dark(rgba(255, 255, 255, 0.4), rgba(0, 0, 0, 0.2));
        overflow: auto;
        position: relative;
        display: flex;
        flex-direction: column;

        .empty-hint {
          display: flex;
          align-items: center;
          justify-content: center;
          position: absolute;
          inset: 0;
          top: 50px;
          color: var(--muted);
          font-size: calc(var(--fs-base) * 1.05);
          z-index: 0;
          margin: 0;
          pointer-events: none;
        }

        &:has(tbody > tr) .empty-hint {
          display: none;
        }
      }

      table {
        width: 100%;
        min-width: 800px;
        table-layout: auto;
        border-collapse: separate;
        border-spacing: 0;

        thead th {
          padding: 12px 10px;
          border-bottom: 1px solid var(--line);
          font-variant-numeric: tabular-nums;
          position: sticky;
          top: 0;
          z-index: 10;
          background: var(--card-bg);
          backdrop-filter: blur(12px);
          text-align: left;
          font-weight: 600;
          color: var(--muted);
          white-space: nowrap;
          box-shadow: 0 1px 0 var(--line);

          &:first-child {
            border-top-left-radius: 16px;
          }

          &:last-child {
            border-top-right-radius: 16px;
          }

          &:nth-child(1),
          &:nth-child(2) {
            width: 50px;
            text-align: center;
          }

          &:nth-child(3) {
            width: 180px;
          }

          &:nth-child(4),
          &:nth-child(5),
          &:nth-child(6),
          &:nth-child(7) {
            width: 80px;
          }

          &:nth-child(8) {
            min-width: 160px;
          }

          &:nth-child(9) {
            min-width: 75px;
            width: 240px;
          }
        }

        tbody {
          td {
            padding: 12px 10px;
            border-bottom: 1px solid var(--line);
            font-variant-numeric: tabular-nums;
            color: var(--fg);
            vertical-align: top;
            font-weight: 400;
            white-space: normal;
            word-break: keep-all;
            overflow-wrap: break-word;
            transition: background 0.1s;
          }

          td:nth-child(1),
          td:nth-child(2) {
            text-align: center;
          }

          td:nth-child(3) {
            color: var(--accent);
            letter-spacing: -0.02em;
          }

          td:nth-child(9) {
            white-space: nowrap;
          }

          tr:hover {
            background: light-dark(rgba(0, 0, 0, 0.05),
                rgba(255, 255, 255, 0.08));
            z-index: 1;
          }

          tr:last-child {
            td {
              border-bottom: none;
            }
          }
        }
      }

      @supports (content-visibility: auto) {
        .table-wrap tbody tr {
          content-visibility: auto;
          contain-intrinsic-size: var(--row-size);
        }
      }

      @container card (max-width:800px) {
        .table-wrap:not(:has(tbody > tr)) {
          min-height: 100px;
          overflow: hidden;
        }

        .table-wrap:not(:has(tbody > tr)) .empty-hint {
          top: 0;
        }

        table {
          display: block;
          min-width: 0;

          thead {
            display: none;
          }

          tbody {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 12px;

            tr {
              display: flex;
              flex-direction: column;
              background: var(--card-bg);
              border: 1px solid var(--line);
              border-radius: 12px;
              padding: 12px;
              gap: 8px;
              box-shadow: var(--shadow-sm);

              &:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-md);
                transition: transform 0.2s;
              }
            }

            td {
              border: none;
              padding: 4px 0;
              display: grid;
              grid-template-columns: 80px 1fr;
              gap: 12px;
              align-items: baseline;
              text-align: left !important;
              width: auto !important;

              &::before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--muted);
                font-size: var(--fs-sm);
                text-transform: uppercase;
                letter-spacing: 0.05em;
                text-align: left;
              }
            }
          }
        }

        .map-sep {
          display: none;
        }
      }

      .skeleton-bar {
        height: 12px;
        width: 100%;
        background: linear-gradient(90deg,
            transparent,
            light-dark(rgba(0, 0, 0, 0.06), rgba(255, 255, 255, 0.1)),
            transparent);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 4px;
      }

      .tag-badge {
        display: inline-block;
        font-size: var(--fs-sm);
        font-weight: 500;
        color: var(--fg);
        background: light-dark(rgba(0, 0, 0, 0.05), rgba(255, 255, 255, 0.1));
        padding: 2px 6px;
        border-radius: 4px;
        border: 1px solid var(--line);
        white-space: normal;
        word-break: keep-all;
        overflow-wrap: anywhere;
        max-width: 100%;
        text-align: center;
      }

      .tags-cell {
        padding-top: 10px;
      }

      a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
        white-space: nowrap;

        &:hover {
          color: var(--success);
          text-decoration: underline;
        }
      }

      @keyframes shimmer {
        0% {
          background-position: 100% 0;
        }

        100% {
          background-position: -100% 0;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    }

    @layer utilities {
      .caps {
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: var(--fs-sm);
        font-weight: 700;
        color: var(--muted);
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    }
  </style>
</head>

<body>
  <main id="main-content">
    <section class="card">
      <header class="brand">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" aria-hidden="true">
          <path
            d="M256,0C153.755,0,70.573,83.182,70.573,185.426c0,126.888,165.939,313.167,173.004,321.035 c6.636,7.391,18.222,7.378,24.849,0c7.065-7.868,173.004-194.147,173.004-321.035C441.427,83.182,358.245,0,256,0z M256,278.719c-51.442,0-93.292-41.851-93.292-93.292c0-51.441,41.851-93.292,93.292-93.292 c51.441,0,93.292,41.851,93.292,93.292C349.292,236.868,307.441,278.719,256,278.719z" />
        </svg>
        <div>
          <h1>SRG 역지오코딩</h1>
          <p>random_data.txt 좌표 변환</p>
        </div>
      </header>
      <h2 id="controls-title" class="sr-only">파일 업로드 및 실행</h2>
      <form class="row">
        <fieldset class="row">
          <legend class="sr-only">
            random_data.txt 파일 업로드 및 조회 제어
          </legend>
          <label class="drop-zone" data-has-file="false">
            <svg class="drop-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"
              aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
            </svg>
            <span class="drop-text">
              <span class="desktop-msg">클릭 또는 드래그 앤 드롭하여 <strong>random_data.txt</strong> 업로드</span>
              <span class="mobile-msg">터치하여 <strong>random_data.txt</strong> 업로드</span>
            </span>
            <input type="file" id="file" accept=".txt">
          </label>
          <div class="row">
            <button type="submit" id="parse">좌표 추출</button>
            <button type="button" id="start" disabled>조회 시작</button>
            <button type="button" id="pause" disabled>일시정지</button>
            <button type="button" id="resume" disabled>재개</button>
            <button type="button" id="stop" disabled>중지</button>
            <button type="button" id="export" disabled>CSV 내보내기</button>
          </div>
        </fieldset>
      </form>
      <div>
        <label for="coords"><span class="caps">추출된 좌표 (lat,lon)</span></label>
        <textarea id="coords" readonly spellcheck="false" placeholder="좌표가 이곳에 표시됩니다."></textarea>
      </div>
      <div class="row-progress">
        <div class="sp">
          <label class="caps" id="prog-label" for="prog">진행 상황 0%</label>
          <div id="prog-shell" class="progress-shell">
            <progress id="prog" value="0" max="100"></progress>
            <div class="progress-visual">
              <div class="progress-fill"></div>
            </div>
          </div>
        </div>
        <output id="counts" aria-live="polite">총 <strong id="cnt-total">0</strong>건 중
          <strong id="cnt-success">0</strong>건 완료,<br><strong id="cnt-fail">0</strong>건 실패, <strong
            id="cnt-remain">0</strong>건 미처리</output>
      </div>
      <output id="status" class="status" role="status" aria-atomic="true"></output>
      <footer>
        <p>• 품질을 위해 속도는 초당 1회로 제한됩니다.</p>
      </footer>
    </section>
    <section class="card">
      <header class="card-header">
        <h2 id="results-title">결과 표</h2>
        <p class="header-desc">좌표별 주소 및 지도 링크</p>
      </header>
      <div class="table-wrap">
        <p class="empty-hint">
          데이터를 분석하고 조회를 시작하면 결과가 표시됩니다.
        </p>
        <table id="tbl">
          <caption class="sr-only">
            역지오코딩 결과 표
          </caption>
          <thead>
            <tr>
              <th scope="col" data-col-key="kind">구분</th>
              <th scope="col" data-col-key="idx">순번</th>
              <th scope="col" data-col-key="coords">좌표 (위도,경도)</th>
              <th scope="col" data-col-key="sido">시·도</th>
              <th scope="col" data-col-key="sigungu">시·군·구</th>
              <th scope="col" data-col-key="emd">읍·면·동·리</th>
              <th scope="col" data-col-key="tag">지물 태그</th>
              <th scope="col" data-col-key="fullAddr">전체주소</th>
              <th scope="col" data-col-key="maps">지도링크</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>
  <noscript>이 도구는 자바스크립트가 필요합니다.</noscript>
  <script type="module">
    const COORD_REGEX = Object.freeze({
      KR: /대한민국\s*위경도\s*[:：]\s*(?<lat>[+-]?\d+(?:\.\d+)?)\s*[,，]\s*(?<lon>[+-]?\d+(?:\.\d+)?)/gi,
      WORLD:
        /세계\s*위경도\s*[:：]\s*(?<lat>[+-]?\d+(?:\.\d+)?)\s*[,，]\s*(?<lon>[+-]?\d+(?:\.\d+)?)/gi,
    });
    const RX_CSV = /[",\n\r]/;
    const CONFIG = Object.freeze({
      MAX_RETRY: 3,
      REQUEST_TIMEOUT_MS: 10000,
      RATE_LIMIT_DELAY_MS: 1000,
      REVERSE_ZOOM: 14,
      SPECIAL_CITIES: /서울|부산|대구|인천|광주|대전|울산|세종/,
    });
    const MAP_PROVIDERS = Object.freeze([
      {
        key: "Google",
        header: "지도링크(Google)",
        url: (lat, lon) => `https://www.google.com/maps?q=${lat},${lon}`,
      },
      {
        key: "OSM",
        header: "지도링크(OSM)",
        url: (lat, lon) =>
          `https://www.openstreetmap.org/search?query=${lat},${lon}&zoom=16#map=16/${lat}/${lon}`,
      },
      {
        key: "Naver",
        header: "지도링크(Naver)",
        url: (lat, lon) =>
          `https://map.naver.com/?lng=${lon}&lat=${lat}&title=${lat}%20${lon}`,
      },
      {
        key: "Kakao",
        header: "지도링크(Kakao)",
        url: (lat, lon) =>
          `https://map.kakao.com/link/map/${lat}%20${lon},${lat},${lon}`,
      },
    ]);
    const BASE_COL_CONFIG = Object.freeze({
      kind: {
        val: (r) => r.set,
      },
      idx: {
        val: (r) => r.idx,
      },
      coords: {
        val: (r) => `${r.lat}, ${r.lon}`,
      },
      sido: {
        val: (r) => r.addr?.sido,
      },
      sigungu: {
        val: (r) => r.addr?.sigungu,
      },
      emd: {
        val: (r) => r.addr?.eupmyeon,
      },
      tag: {
        val: (r) => r.addr?.tag,
        render: (v, td) => {
          if (v) {
            const s = document.createElement("span");
            s.className = "tag-badge";
            s.textContent = v;
            td.appendChild(s);
          }
          td.className = "tags-cell";
        },
      },
      fullAddr: {
        val: (r) => r.fullAddr,
      },
      maps: {
        noCsv: true,
        render: (_, td, r) => {
          const wrap = document.createElement("div");
          wrap.style.display = "flex";
          wrap.style.flexWrap = "wrap";
          wrap.style.gap = "6px";
          wrap.style.alignItems = "center";
          MAP_PROVIDERS.forEach((p, i) => {
            const a = document.createElement("a");
            a.href = p.url(r.lat, r.lon);
            a.target = "_blank";
            a.rel = "noopener noreferrer";
            a.textContent = p.key;
            wrap.appendChild(a);
            if (i < MAP_PROVIDERS.length - 1) {
              const sep = document.createElement("span");
              sep.textContent = "·";
              sep.className = "map-sep";
              sep.style.color = "var(--muted)";
              wrap.appendChild(sep);
            }
          });
          td.appendChild(wrap);
        },
      },
    });
    const numberFormatter = new Intl.NumberFormat("ko-KR");
    const listFormatter = new Intl.ListFormat("ko", {
      style: "narrow",
      type: "unit",
    });
    const thead = document.querySelector("#tbl thead");
    const domElements = {
      file: document.getElementById("file"),
      dropZoneText: document.querySelector(".drop-text"),
      parse: document.getElementById("parse"),
      start: document.getElementById("start"),
      pause: document.getElementById("pause"),
      resume: document.getElementById("resume"),
      stop: document.getElementById("stop"),
      exportBtn: document.getElementById("export"),
      status: document.getElementById("status"),
      cntTotal: document.getElementById("cnt-total"),
      cntSuccess: document.getElementById("cnt-success"),
      cntFail: document.getElementById("cnt-fail"),
      cntRemain: document.getElementById("cnt-remain"),
      progShell: document.getElementById("prog-shell"),
      prog: document.getElementById("prog"),
      progLabel: document.getElementById("prog-label"),
      tbody: document.querySelector("#tbl tbody"),
      coords: document.getElementById("coords"),
    };
    const form = document.querySelector("form.row");
    const COL_DEFS = Array.from(thead.querySelectorAll("th")).map((th) => {
      const key = th.dataset.colKey;
      const base = BASE_COL_CONFIG[key] || {};
      return {
        key,
        label: th.textContent.trim(),
        ...base,
      };
    });
    const AddressFormatter = {
      _getKoreanAdminArea(a, tag) {
        let sido = a.province || a.state || a.region || "";
        let tmpCity = a.city || a.county || a.municipality || "";
        let tmpGu = a.district || a.borough || a.suburb || "";
        let sigungu;
        const isSpecialCity = CONFIG.SPECIAL_CITIES.test(tmpCity);
        if (!sido && isSpecialCity) {
          sido = tmpCity;
          sigungu = tmpGu;
        } else {
          sigungu = tmpCity;
          if (tmpCity && tmpGu && tmpCity !== tmpGu) {
            if (!sigungu.includes(tmpGu)) sigungu += " " + tmpGu;
          } else if (!sigungu) {
            sigungu = tmpGu;
          }
        }
        const emd =
          a.town || a.township || a.neighbourhood || a.city_district || "";
        const ri = a.village || a.hamlet || "";
        const eupmyeon = emd && ri ? `${emd} ${ri}` : emd || ri || "";
        return { sido, sigungu, eupmyeon, tag };
      },
      _getTag(a, data) {
        if (!data || typeof data !== "object") return "";
        const name = data.name || a.attraction || a.building;
        const addType = data.addresstype;
        const category = data.category;
        const parts = [];
        if (name) parts.push(name);
        if (addType && addType !== name) parts.push(addType);
        else if (category && category !== name) parts.push(category);
        return parts.length > 0 ? listFormatter.format(parts) : "";
      },
      parse(data) {
        const a = data?.address ?? {};
        const isKR =
          (a.country_code || "").toLowerCase() === "kr" ||
          a.country === "대한민국";
        const tag = this._getTag(a, data);
        if (isKR) return this._getKoreanAdminArea(a, tag);
        return {
          sido: a.state || a.region || a.province || a.county || a.city || "",
          sigungu:
            a.city ||
            a.town ||
            a.county ||
            a.district ||
            a.municipality ||
            a.region ||
            "",
          eupmyeon:
            a.village ||
            a.suburb ||
            a.neighbourhood ||
            a.quarter ||
            a.hamlet ||
            a.city_district ||
            a.township ||
            a.residential ||
            "",
          tag,
        };
      },
    };
    const AppState = {
      records: [],
      processedCount: 0,
      droppedFile: null,
      status: "idle",
      controller: null,
      resumeHandler: null,
      inFlight: false,
      renderReq: null,
      cntSuccess: 0,
      cntFail: 0,
      get isRunning() {
        return (
          this.status === "running" ||
          this.status === "paused" ||
          this.status === "pausing"
        );
      },
      get isPaused() {
        return this.status === "paused";
      },
      get isPausing() {
        return this.status === "pausing";
      },
      get isStopping() {
        return this.status === "stopping";
      },
      reset() {
        this.processedCount = 0;
        this.cntSuccess = 0;
        this.cntFail = 0;
        this.status = "idle";
        this.controller = null;
        this.resumeHandler = null;
        this.inFlight = false;
        this.renderReq = null;
      },
      setRecords(newRecords) {
        this.records = newRecords;
        this.reset();
        updateUIState();
      },
      setFile(file) {
        this.droppedFile = file;
        updateUIState();
      },
      setStatus(st) {
        this.status = st;
        updateUIState();
      },
    };
    const fileDateFmt = new Intl.DateTimeFormat("ko-KR", {
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
      hour12: false,
      timeZone: "Asia/Seoul",
    });
    function updateUIState() {
      const s = AppState.status;
      const hasRecords = AppState.records.length > 0;
      const { parse, start, pause, resume, stop, exportBtn, progShell } =
        domElements;
      parse.disabled =
        s === "running" ||
        s === "paused" ||
        s === "pausing" ||
        s === "parsing";
      start.disabled =
        !hasRecords ||
        s === "running" ||
        s === "paused" ||
        s === "pausing" ||
        s === "stopping" ||
        s === "parsing";
      pause.disabled = s !== "running";
      resume.disabled = s !== "paused";
      stop.disabled = s === "idle" || s === "stopping";
      exportBtn.disabled = AppState.processedCount === 0;
      if (s === "running" || s === "pausing") {
        progShell.classList.add("active");
      } else {
        progShell.classList.remove("active");
      }
    }
    function setStatus(msg, type = "info") {
      const el = domElements.status;
      el.textContent = msg;
      el.classList.remove("err", "warn");
      if (type === "error") el.classList.add("err");
      else if (type === "warn") el.classList.add("warn");
    }
    function scheduleRender() {
      if (AppState.renderReq) return;
      AppState.renderReq = requestAnimationFrame(() => {
        const total = AppState.records.length;
        const processed = AppState.processedCount;
        const success = AppState.cntSuccess;
        const fail = AppState.cntFail;
        const remaining = Math.max(0, total - processed);
        domElements.cntTotal.textContent = numberFormatter.format(total);
        domElements.cntSuccess.textContent = numberFormatter.format(success);
        domElements.cntFail.textContent = numberFormatter.format(fail);
        domElements.cntRemain.textContent = numberFormatter.format(remaining);
        const pct = total ? Math.round((processed / total) * 100) : 0;
        domElements.prog.value = pct;
        domElements.progShell.style.setProperty("--pct", String(pct));
        domElements.progLabel.textContent = `진행 상황 ${pct}%`;
        updateUIState();
        AppState.renderReq = null;
      });
    }
    function clearTable() {
      domElements.tbody.replaceChildren();
    }
    function sleep(ms, signal) {
      if (!signal) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }
      signal.throwIfAborted();
      const timeoutSig = AbortSignal.timeout(ms);
      const combined = AbortSignal.any([signal, timeoutSig]);
      return new Promise((resolve, reject) => {
        combined.addEventListener(
          "abort",
          () => {
            if (signal.aborted && !timeoutSig.aborted) {
              reject(signal.reason);
            } else {
              resolve();
            }
          },
          { once: true }
        );
      });
    }
    async function yieldToMain() {
      if ("scheduler" in window && "yield" in window.scheduler)
        await window.scheduler.yield();
      else await new Promise((r) => setTimeout(r, 0));
    }
    function extractCoordinates(text) {
      const out = [];
      const push = (lat, lon, setLabel) => {
        if (
          Number.isFinite(lat) &&
          Number.isFinite(lon) &&
          Math.abs(lat) <= 90 &&
          Math.abs(lon) <= 180
        ) {
          out.push({ lat, lon, setLabel });
        }
      };
      for (const m of text.matchAll(COORD_REGEX.KR)) {
        const { lat, lon } = m.groups;
        push(parseFloat(lat), parseFloat(lon), "KR");
      }
      for (const m of text.matchAll(COORD_REGEX.WORLD)) {
        const { lat, lon } = m.groups;
        push(parseFloat(lat), parseFloat(lon), "WORLD");
      }
      return out;
    }
    async function performPauseCheck() {
      if (AppState.isPausing) {
        AppState.setStatus("paused");
        setStatus('일시정지됨. "재개"를 눌러 이어서 진행(단축키 S)', "warn");
        if (!AppState.resumeHandler)
          AppState.resumeHandler = Promise.withResolvers();
        scheduleRender();
        await AppState.resumeHandler.promise;
        if (!AppState.isStopping)
          setStatus("재개합니다… (단축키 Esc로 중지)");
      }
    }
    async function fetchReverseWithRetry(lat, lon, userSignal) {
      const buildUrl = () => {
        const url = new URL("https://nominatim.openstreetmap.org/reverse");
        url.searchParams.set("format", "jsonv2");
        url.searchParams.set("lat", String(lat));
        url.searchParams.set("lon", String(lon));
        url.searchParams.set("zoom", String(CONFIG.REVERSE_ZOOM));
        url.searchParams.set("addressdetails", "1");
        url.searchParams.set("accept-language", "ko");
        return url;
      };
      let attempt = 0;
      while (attempt < CONFIG.MAX_RETRY) {
        userSignal?.throwIfAborted();
        attempt++;
        try {
          const timeoutSig = AbortSignal.timeout(CONFIG.REQUEST_TIMEOUT_MS);
          const combinedSignal = userSignal
            ? AbortSignal.any([userSignal, timeoutSig])
            : timeoutSig;
          const res = await fetch(buildUrl(), {
            headers: { Accept: "application/json" },
            signal: combinedSignal,
          });
          if (res.ok) {
            return res.json();
          }
          if (res.status === 429 || res.status >= 500) {
            await sleep(CONFIG.RATE_LIMIT_DELAY_MS * attempt, userSignal);
            continue;
          }
          const text = await res.text();
          throw new Error(`HTTP ${res.status}: ${text.slice(0, 200)}`);
        } catch (e) {
          userSignal?.throwIfAborted();
          if (attempt >= CONFIG.MAX_RETRY) {
            throw e;
          }
          await sleep(CONFIG.RATE_LIMIT_DELAY_MS * attempt, userSignal);
        }
      }
    }
    function appendSkeletonRow(idx) {
      const tr = document.createElement("tr");
      tr.className = "skeleton-row";
      COL_DEFS.forEach((col) => {
        const td = document.createElement("td");
        td.dataset.label = col.label;
        if (col.key === "idx") {
          td.textContent = idx;
        } else {
          const bar = document.createElement("div");
          bar.className = "skeleton-bar";
          td.appendChild(bar);
        }
        tr.appendChild(td);
      });
      domElements.tbody.appendChild(tr);
      return tr;
    }
    function fillRow(tr, row) {
      tr.classList.remove("skeleton-row");
      tr.replaceChildren();
      COL_DEFS.forEach((col) => {
        const td = document.createElement("td");
        td.dataset.label = col.label;
        const val = col.val ? col.val(row) : "";
        if (col.render) col.render(val, td, row);
        else td.textContent = val ?? "";
        tr.appendChild(td);
      });
    }
    function pushResultRow(row) {
      AppState.processedCount++;
      if (row.set === "에러") AppState.cntFail++;
      else AppState.cntSuccess++;
      scheduleRender();
    }
    function updateIntrinsicRowSize() {
      const tbody = domElements.tbody;
      const rows = tbody.rows;
      const len = rows.length;
      if (!len) return;
      const sampleLimit = Math.min(len, 120);
      const start = Math.max(0, len - sampleLimit);
      let total = 0;
      let count = 0;
      for (let i = len - 1; i >= start; i -= 2) {
        const row = rows[i];
        if (!row) continue;
        const rect = row.getBoundingClientRect();
        const h = rect.height;
        if (!h || !Number.isFinite(h)) continue;
        total += h;
        count++;
      }
      if (!count) return;
      const avg = total / count;
      if (!Number.isFinite(avg) || avg <= 0) return;
      const clamped = Math.max(20, Math.min(avg, 240));
      document.documentElement.style.setProperty(
        "--row-size",
        `${clamped}px`
      );
    }
    function maybeUpdateIntrinsicRowSize() {
      const n = AppState.processedCount;
      if (n === 1 || n === 50 || n % 200 === 0) updateIntrinsicRowSize();
    }
    async function runProcessingLoop() {
      const startIndex = AppState.processedCount;
      for (let i = startIndex; i < AppState.records.length; i++) {
        if (!AppState.isRunning || AppState.isStopping) break;
        await performPauseCheck();
        if (!AppState.isRunning || AppState.isStopping) break;
        const r = AppState.records[i];
        AppState.controller = new AbortController();
        AppState.inFlight = true;
        const skeletonTr = appendSkeletonRow(r.idx);
        try {
          if (i > startIndex)
            await sleep(
              CONFIG.RATE_LIMIT_DELAY_MS,
              AppState.controller.signal
            );
          if (!AppState.isRunning || AppState.isStopping) {
            skeletonTr.remove();
            break;
          }
          await performPauseCheck();
          if (!AppState.isRunning || AppState.isStopping) {
            skeletonTr.remove();
            break;
          }
          if (!AppState.isPaused)
            setStatus(
              `처리 중… (${i + 1}/${AppState.records.length
              }) (단축키: S=일시정지, Esc=중지)`
            );
          const data = await fetchReverseWithRetry(
            r.lat,
            r.lon,
            AppState.controller.signal
          );
          const parsedAddr = AddressFormatter.parse(data);
          r.addr = parsedAddr;
          r.fullAddr = data.display_name || "";
          fillRow(skeletonTr, r);
          pushResultRow(r);
          maybeUpdateIntrinsicRowSize();
        } catch (err) {
          const msg = err && (err.message || String(err));
          const isAbort =
            err && (err.name === "AbortError" || /aborted/i.test(msg));
          if (AppState.isStopping && isAbort) {
            skeletonTr.remove();
            break;
          }
          console.error(err);
          r.set = "에러";
          r.fullAddr = msg;
          fillRow(skeletonTr, r);
          pushResultRow(r);
          maybeUpdateIntrinsicRowSize();
          if (!AppState.isStopping)
            setStatus(
              `에러 발생: (${i + 1}/${AppState.records.length}) ${msg}`,
              "error"
            );
        } finally {
          AppState.inFlight = false;
          scheduleRender();
        }
      }
      if (AppState.isStopping) {
        setControlsIdle("중지되었습니다.", "warn");
      } else if (AppState.processedCount >= AppState.records.length) {
        setControlsIdle("모든 처리가 완료되었습니다.", "info");
      }
    }
    function setControlsIdle(message, type = "info") {
      AppState.setStatus("idle");
      setStatus(message, type);
      scheduleRender();
    }
    function startProcessing() {
      AppState.reset();
      AppState.setStatus("running");
      clearTable();
      scheduleRender();
      setStatus("조회 시작… (단축키: S=일시정지, Esc=중지)");
      runProcessingLoop();
    }
    domElements.exportBtn.addEventListener("click", async () => {
      try {
        const rows = AppState.records.slice(0, AppState.processedCount);
        if (!rows.length) {
          return setStatus("내보낼 데이터가 없습니다.", "warn");
        }
        const headerCols = COL_DEFS.filter((c) => !c.noCsv);
        const mapHeaders = MAP_PROVIDERS.map((p) => p.header);
        const esc = (s) => {
          s = String(s ?? "");
          return RX_CSV.test(s) ? `"${s.replaceAll('"', '""')}"` : s;
        };
        const makeRow = (r) => {
          const rowArr = [];
          for (let i = 0; i < headerCols.length; i++) {
            rowArr.push(esc(headerCols[i].val(r)));
          }
          for (let i = 0; i < MAP_PROVIDERS.length; i++) {
            rowArr.push(esc(MAP_PROVIDERS[i].url(r.lat, r.lon)));
          }
          return rowArr.join(",") + "\n";
        };
        const headerStr =
          [
            ...headerCols.map((c) => esc(c.label)),
            ...mapHeaders.map(esc),
          ].join(",") + "\n";
        const dateStr = fileDateFmt.format(new Date()).replace(/\D/g, "");
        const fileName = `result_${dateStr}.csv`;
        const lines = ["\uFEFF" + headerStr];
        for (const r of rows) lines.push(makeRow(r));
        const blob = new Blob(lines, { type: "text/csv;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        setStatus("CSV 파일을 다운로드했습니다.");
      } catch (err) {
        console.error(err);
        setStatus(`저장 실패: ${err.message}`, "error");
      }
    });
    async function handleParse() {
      if (domElements.parse.disabled) return;
      try {
        const file = AppState.droppedFile;
        if (!file) {
          return setStatus("파일을 선택해 주세요.", "warn");
        }
        AppState.setStatus("parsing");
        setStatus("파일 읽는 중…");
        const text = await file.text();
        setStatus("좌표 추출 중…");
        await yieldToMain();
        const parsed = await extractCoordinates(text);
        if (!parsed.length) {
          AppState.setRecords([]);
          domElements.coords.value = "";
          scheduleRender();
          return setStatus("좌표를 찾지 못했습니다.", "warn");
        }
        const records = parsed.map((p, i) => ({
          set: p.setLabel === "KR" ? "KR" : "WORLD",
          idx: i + 1,
          lat: p.lat,
          lon: p.lon,
        }));
        AppState.setRecords(records);
        const MAX_DISP = 50000;
        const disp = records
          .slice(0, MAX_DISP)
          .map((r) => `${r.lat},${r.lon}`);
        if (records.length > MAX_DISP)
          disp.push(
            `... 외 ${numberFormatter.format(
              records.length - MAX_DISP
            )}건 생략됨`
          );
        domElements.coords.value = disp.join("\n");
        clearTable();
        scheduleRender();
        setStatus(
          `분석 완료: ${records.length}개 좌표. 조회 시작을 누르세요(단축키 S)`
        );
      } catch (err) {
        console.error(err);
        setStatus(`오류 발생: ${err.message}`, "error");
      }
    }
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      void handleParse();
    });
    domElements.start.addEventListener("click", () => {
      document.startViewTransition
        ? document.startViewTransition(startProcessing)
        : startProcessing();
    });
    domElements.pause.addEventListener("click", () => {
      if (!AppState.isRunning) return;
      AppState.setStatus("pausing");
      if (AppState.inFlight)
        setStatus("일시정지 요청됨. 현재 작업을 마치고 멈춥니다...", "warn");
    });
    domElements.resume.addEventListener("click", () => {
      if (!AppState.isPaused) return;
      AppState.setStatus("running");
      if (AppState.resumeHandler) {
        AppState.resumeHandler.resolve();
        AppState.resumeHandler = null;
      }
    });
    domElements.stop.addEventListener("click", () => {
      if (!AppState.isRunning) return;
      AppState.setStatus("stopping");
      if (AppState.resumeHandler) {
        AppState.resumeHandler.resolve();
        AppState.resumeHandler = null;
      }
      if (AppState.inFlight && AppState.controller) {
        AppState.controller.abort();
        setStatus("중지 요청됨. 취소 중…", "warn");
      } else {
        setStatus("중지 요청됨. 정리 중…", "warn");
      }
    });
    function handleFile(files) {
      if (!files.length) return;
      const file = files[0];
      AppState.setFile(file);
      setStatus(
        `파일 선택됨: ${file.name} 추출 버튼을 누르세요(단축키 P)`
      );
      const label = domElements.file.closest(".drop-zone");
      if (label) {
        label.dataset.hasFile = "true";
      }
      const desktopMsg = domElements.dropZoneText.querySelector(".desktop-msg");
      const mobileMsg = domElements.dropZoneText.querySelector(".mobile-msg");
      if (desktopMsg) {
        desktopMsg.textContent = "선택된 파일: ";
        const strong = document.createElement("strong");
        strong.textContent = file.name;
        desktopMsg.appendChild(strong);
      }
      if (mobileMsg) {
        mobileMsg.textContent = "선택된 파일: ";
        const strong = document.createElement("strong");
        strong.textContent = file.name;
        mobileMsg.appendChild(strong);
      }
      domElements.file.value = "";
    }
    domElements.file.addEventListener("change", () => {
      handleFile(domElements.file.files);
    });
    document.body.addEventListener("dragenter", (e) => {
      e.preventDefault();
      document.body.classList.add("is-dragging");
    });
    document.body.addEventListener("dragover", (e) => e.preventDefault());
    document.body.addEventListener("dragleave", (e) => {
      e.preventDefault();
      if (!e.relatedTarget) document.body.classList.remove("is-dragging");
    });
    document.body.addEventListener("drop", (e) => {
      e.preventDefault();
      document.body.classList.remove("is-dragging");
      handleFile(e.dataTransfer.files);
    });
    const hotkeys = {
      p: () => {
        if (domElements.parse.disabled) return;
        if (typeof form.requestSubmit === "function") {
          form.requestSubmit();
        } else {
          void handleParse();
        }
      },
      escape: () => {
        if (!domElements.stop.disabled) {
          domElements.stop.click();
        }
      },
      s: () => {
        if (!domElements.resume.disabled) domElements.resume.click();
        else if (!domElements.pause.disabled) domElements.pause.click();
        else if (!domElements.start.disabled) domElements.start.click();
      },
    };
    window.addEventListener("keydown", (e) => {
      if (e.altKey || e.ctrlKey || e.metaKey) return;
      if (e.isComposing) return;
      const key = e.key.toLowerCase();
      const handler = hotkeys[key];
      if (!handler) return;
      e.preventDefault();
      handler();
    });
    document.addEventListener("pointermove", (e) => {
      const target = e.target.closest(".card, button");
      if (!target) return;
      const rect = target.getBoundingClientRect();
      target.style.setProperty("--mouse-x", `${e.clientX - rect.left}px`);
      target.style.setProperty("--mouse-y", `${e.clientY - rect.top}px`);
    });
  </script>
</body>

</html>